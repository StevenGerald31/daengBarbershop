<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <!-- Jquery -->
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>

    <!-- bootstrap icon -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="/stylesheets/cobaAdmin.css" />

    <title id="pageTitle">Dashboard</title>
  </head>
  <body>
    <!-- SIDEBAR MENU -->
    <div class="sidebar">
      <!-- SIDEBAR HEADER -->
      <div class="side-header">
        <div class="image">
          <img src="/image/logoFIX1.png" />
        </div>
        <div class="judul">
          <h2>Halo Admin</h2>
        </div>
      </div>

      <!-- SIDEBAR MENU KONTEN -->
      <div class="side-content">
        <div class="side-menu">
          <ul class="nav flex-column" id="myTab" role="tablist">
            <!-- sidebar dashboard  -->
            <li
              id="Dashboard"
              class="nav-item hover active"
              style="margin-bottom: 10px"
            >
              <div
                class="a nav-link"
                id="Dashboards"
                data-bs-toggle="tab"
                data-bs-target="#Dashboards-pane"
                type="button"
                role="tab"
                aria-controls="Dashboards-pane"
                aria-selected="true"
              >
                <i class="bi bi-house-door"></i>
                <small style="margin-left: 5px">Dashboards</small>
              </div>
            </li>

            <!-- sidebar penjelajahan -->
            <li
              id="DataPelanggan"
              class="nav-item hover"
              style="margin-bottom: 10px"
            >
              <div
                class="a nav-link"
                id="DataPelanggan"
                data-bs-toggle="tab"
                data-bs-target="#DataPelanggan-pane"
                type="button"
                role="tab"
                aria-controls="DataPelanggan-pane"
                aria-selected="false"
              >
                <small style="margin-left: 5px">Data Pelanggan</small>
              </div>
            </li>

            <!-- sidebar Data Server -->
            <li
              id="DataServer"
              class="nav-item hover"
              style="margin-bottom: 10px"
            >
              <div
                class="a nav-link"
                id="DataServer"
                data-bs-toggle="tab"
                data-bs-target="#DataServer-pane"
                type="button"
                role="tab"
                aria-controls="DataServer-pane"
                aria-selected="false"
              >
                <small style="margin-left: 5px">Data Server</small>
              </div>
            </li>

            <!-- sidebar Data Konten -->
            <li
              id="DataKonten"
              class="nav-item hover"
              style="margin-bottom: 10px"
            >
              <div
                class="a nav-link"
                id="DataKonten"
                data-bs-toggle="tab"
                data-bs-target="#DataKonten-pane"
                type="button"
                role="tab"
                aria-controls="DataKonten-pane"
                aria-selected="false"
              >
                <small style="margin-left: 5px">Data Konten</small>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- KONTEN DASHBOARD -->
    <div class="main-content tab-content">
      <!-- MAIN KONTEN DASHBOARD -->
      <div
        class="tab-pane fade show active"
        id="Dashboards-pane"
        role="tabpanel"
        aria-labelledby="Dashboards"
        tabindex="0"
      >
        <main class="Dashboard">
          <div class="row-judul">
            <h2 class="fw-bold pt-3">Daeng Barbershop</h2>
            <div class="content-wrap">
              <div class="content">
                <section
                  class="info-boxes d-flex align-items-center justify-content-center"
                >
                  <div class="info-box">
                    <div class="box-icon">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                      >
                        <path
                          d="M21 20V4a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1zm-2-1H5V5h14v14z"
                        />
                        <path
                          d="M10.381 12.309l3.172 1.586a1 1 0 0 0 1.305-.38l3-5-1.715-1.029-2.523 4.206-3.172-1.586a1.002 1.002 0 0 0-1.305.38l-3 5 1.715 1.029 2.523-4.206z"
                        />
                      </svg>
                    </div>
                    <div class="box-content">
                      <span class="big text-center" id="jlhPelanggan"> </span>
                      Pelanggan
                    </div>
                  </div>
                  <div class="info-box">
                    <div class="box-icon">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                      >
                        <path
                          d="M20 10H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V11a1 1 0 0 0-1-1zm-1 10H5v-8h14v8zM5 6h14v2H5zM7 2h10v2H7z"
                        />
                      </svg>
                    </div>
                    <div class="box-content">
                      <span class="big text-center" id="jlhServer"> </span>
                      Server
                    </div>
                  </div>
                  <!-- <div class="info-box">
                    <div class="box-icon">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                      >
                        <path
                          d="M3,21c0,0.553,0.448,1,1,1h16c0.553,0,1-0.447,1-1v-1c0-3.714-2.261-6.907-5.478-8.281C16.729,10.709,17.5,9.193,17.5,7.5 C17.5,4.468,15.032,2,12,2C8.967,2,6.5,4.468,6.5,7.5c0,1.693,0.771,3.209,1.978,4.219C5.261,13.093,3,16.287,3,20V21z M8.5,7.5 C8.5,5.57,10.07,4,12,4s3.5,1.57,3.5,3.5S13.93,11,12,11S8.5,9.43,8.5,7.5z M12,13c3.859,0,7,3.141,7,7H5C5,16.141,8.14,13,12,13z"
                        />
                      </svg>
                    </div>
                    <div class="box-content">
                      <span class="big text-center" id="jlhVoucher"> </span>
                      Voucher
                    </div>
                  </div> -->
                  <div class="info-box">
                    <div class="box-icon">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                      >
                        <path
                          d="M12 3C6.486 3 2 6.364 2 10.5c0 2.742 1.982 5.354 5 6.678V21a.999.999 0 0 0 1.707.707l3.714-3.714C17.74 17.827 22 14.529 22 10.5 22 6.364 17.514 3 12 3zm0 13a.996.996 0 0 0-.707.293L9 18.586V16.5a1 1 0 0 0-.663-.941C5.743 14.629 4 12.596 4 10.5 4 7.468 7.589 5 12 5s8 2.468 8 5.5-3.589 5.5-8 5.5z"
                        />
                      </svg>
                    </div>
                    <div class="box-content">
                      <span class="big text-center" id="jlhCabang"> </span>
                      Cabang
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </div>
        </main>
      </div>
      <!-- MAIN KONTEN DASHBOARD AKHIR -->

      <!-- Pelanggan mulai -->
      <div
        class="tab-pane fade"
        id="DataPelanggan-pane"
        role="tabpanel"
        aria-labelledby="DataPelanggan"
        tabindex="0"
      >
        <main class="Hero">
          <div class="row judul">
            <h2 class="fw-bold pt-3">Data Pelanggan</h2>
          </div>
          <div class="row searchPelanggan d-flex justify-content-center">
            <div class="col-6">
              <input
                type="email"
                class="form-control"
                placeholder="Cari id"
                id="exampleInputEmail1"
                aria-describedby="emailHelp"
              />
            </div>
            <div class="col-4">
              <button class="btn btn-primary">Search</button>
            </div>
          </div>
          <div class="row buttonTambah mt-3">
            <div class="col-2">
              <button class="btn btn-primary">Tambah Data</button>
            </div>
          </div>
          <div class="row dataPelanggan">
            <div class="row pt-3">
              <div class="d-flex justify-content-center">
                <h1 class="fw-bold">Data Pelanggan</h1>
              </div>
            </div>
            <div class="row m-3 table-pelanggan">
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">Nama</th>
                    <th scope="col">No Telp</th>
                    <th scope="col">Jenis Kelamin</th>
                    <th scope="col">Alamat</th>
                    <th scope="col">Point</th>
                    <th scope="col">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Rows of data will go here -->
                </tbody>
              </table>
            </div>
          </div>
        </main>
      </div>
      <!-- Penjelajahan Selesai-->

      <!-- Pelanggan mulai -->
      <div
        class="tab-pane fade"
        id="DataServer-pane"
        role="tabpanel"
        aria-labelledby="DataServer"
        tabindex="0"
      >
        <main class="Hero">
          <div class="row judul">
            <h2 class="fw-bold pt-3">Data Server</h2>
          </div>
          <div class="row searchServer d-flex justify-content-center">
            <div class="col-6">
              <input
                type="email"
                class="form-control"
                placeholder="Cari id"
                id="exampleInputEmail1"
                aria-describedby="emailHelp"
              />
            </div>
            <div class="col-4">
              <button class="btn btn-primary">Search</button>
            </div>
          </div>
          <div class="row buttonTambah mt-3">
            <div class="col-2">
              <button
                class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#addServerModal"
              >
                Tambah Server
              </button>
            </div>
          </div>
          <div class="row dataServer">
            <div class="row pt-3">
              <div class="d-flex justify-content-center">
                <h1 class="fw-bold">Data Server</h1>
              </div>
            </div>
            <div class="row m-3 table-server">
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">Nama</th>
                    <th scope="col">No Telp</th>
                    <th scope="col">Jenis Kelamin</th>
                    <th scope="col">Alamat</th>
                    <th scope="col">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Rows of data will go here -->
                </tbody>
              </table>
            </div>
          </div>
          <!-- Modal -->
          <div
            class="modal fade"
            id="addServerModal"
            tabindex="-1"
            aria-labelledby="addServerModalLabel"
            aria-hidden="true"
            data-bs-backdrop="false"
          >
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="addServerModalLabel">
                    Tambah Server
                  </h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="modal-body">
                  <form action="" id="tambahServer">
                    <div class="mb-3">
                      <label for="name" class="form-label">Nama</label>
                      <input
                        type="text"
                        class="form-control"
                        id="name"
                        name="name"
                        required
                      />
                    </div>
                    <!-- <div class="mb-3">
                      <label for="password" class="form-label">Password</label>
                      <input
                        type="text"
                        class="form-control"
                        id="password"
                        name="password"
                        required
                        minlength="8"
                      />
                    </div> -->
                    <div class="mb-3">
                      <label for="password" class="form-label">Password</label>
                      <input
                        type="text"
                        class="form-control"
                        id="password"
                        name="password"
                        required
                        minlength="8"
                        oninput="checkPassword()"
                      />
                      <div
                        id="password-warning"
                        style="color: red; display: none"
                      >
                        Password must be at least 8 characters long.
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="no_telp" class="form-label">Nomor HP</label>
                      <input
                        type="text"
                        class="form-control"
                        id="no_telp"
                        name="no_telp"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label for="tanggal_lahir" class="form-label"
                        >Tanggal Lahir</label
                      >
                      <input
                        type="date"
                        class="form-control"
                        id="tanggal_lahir"
                        name="tanggal_lahir"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label for="jenis_kelamin" class="form-label"
                        >Jenis Kelamin</label
                      >
                      <select
                        class="form-control"
                        id="jenis_kelamin"
                        name="jenis_kelamin"
                        required
                      >
                        <option value="">Pilih Jenis Kelamin</option>
                        <option value="laki-laki">Laki-laki</option>
                        <option value="perempuan">Perempuan</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label for="alamat" class="form-label">Alamat</label>
                      <input
                        type="text"
                        class="form-control"
                        id="alamat"
                        name="alamat"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label for="email" class="form-label">Email</label>
                      <input
                        type="email"
                        class="form-control"
                        id="email"
                        name="email"
                        required
                      />
                    </div>

                    <div class="mb-3">
                      <label for="id_lokasi" class="form-label"
                        >Pilih Lokasi</label
                      >
                      <select
                        class="form-control"
                        id="id_lokasi"
                        name="id_lokasi"
                        required
                      >
                        <option value="">Pilih lokasi</option>
                      </select>
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Close
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary"
                    id="saveNewServer"
                  >
                    Save changes
                  </button>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
      <!-- Penjelajahan Selesai-->

      <!-- Pencarian Selesai -->
    </div>

    <script>
      // jlh pelanggan
      fetch("http://localhost:3000/admin/pelanggan", {
        method: "GET",
      })
        .then((response) => response.json())
        .then((data) => {
          console.log("Jlh Pelanggan: ", data.length);

          $("#jlhPelanggan").html(data.length);
        });

      // jlh server
      fetch("http://localhost:3000/admin/server", {
        method: "GET",
      })
        .then((response) => response.json())
        .then((data) => {
          console.log("Jlh Server: ", data.length);

          $("#jlhServer").html(data.length);
        });

      // jlh cabang
      fetch("http://localhost:3000/admin/lokasi", {
        method: "GET",
      })
        .then((response) => response.json())
        .then((data) => {
          console.log("Jlh Cabang: ", data);

          $("#jlhCabang").html(data.length);
        });

      // Data Pelanggan
      fetch("http://localhost:3000/admin/pelanggan", {
        method: "GET",
      })
        .then((response) => response.json())
        .then((data) => {
          console.log("Data Pelanggan: ", data);

          const tableBody = document.querySelector(".table-pelanggan tbody");
          tableBody.innerHTML = ""; // clear existing rows

          data.forEach((item) => {
            point = item.point;
            if (point == null) {
              point = 0;
            }

            const row = `
              <tr>
                <td>${item.name}</td>
                <td>${item.no_telp}</td>
                <td>${item.jenis_kelamin}</td>
                <td>${item.alamat}</td>
                <td>${point}</td>
                <td>
                 <button type="button" class="btn btn-success m-1" data-bs-toggle="modal" data-bs-target="#resetPassword" id-user="${item.id_user}"">
                        <i class="bi bi bi-pencil"></i>
                      </button>
                  
                </td>
              </tr>
            `;

            tableBody.innerHTML += row;
          });
        });

      // Data Server

      function loadServer() {
        fetch("http://localhost:3000/admin/server", {
          method: "GET",
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Data server: ", data);

            const tableBody = document.querySelector(".table-server tbody");
            tableBody.innerHTML = ""; // clear existing rows

            data.forEach((item) => {
              const row = `
              <tr>
                <td>${item.name}</td>
                <td>${item.no_telp}</td>
                <td>${item.jenis_kelamin}</td>
                <td>${item.alamat}</td>
                <td>
                 <button type="button" class="btn btn-success m-1" data-bs-toggle="modal" data-bs-target="#resetPassword" id-user="${item.id_user}"">
                        <i class="bi bi bi-pencil"></i>
                      </button>
                  
                </td>
              </tr>
            `;

              tableBody.innerHTML += row;
            });
          });
      }

      loadServer();

      // pilihan lokasi:
      fetch("http://localhost:3000/admin/lokasi", {
        method: "GET",
      })
        .then((response) => response.json())
        .then((data) => {
          console.log("lokasi: ", data);

          // Get the select element
          const lokasiSelect = document.getElementById("id_lokasi");

          data.forEach((lokasi) => {
            const option = document.createElement("option");
            option.value = lokasi.id_lokasi;
            option.textContent = lokasi.nama;
            lokasiSelect.appendChild(option);
          });
        })
        .catch((error) => {
          console.error("Error fetching lokasi data:", error);
        });

      // script tambah server
      document.getElementById("saveNewServer").addEventListener("click", () => {
        const form = document.getElementById("tambahServer");
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        fetch("http://localhost:3000/admin/tambahServer", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        })
          .then((response) => {
            if (!response.ok) {
              return response.json().then((error) => {
                throw error;
              });
            }
            return response.json();
          })
          .then((result) => {
            console.log("Success:", result);
            // Handle the successful response here
            alert("Data berhasil ditambahkan");

            // Menutup modal setelah sukses
            const modalElement = document.getElementById("addServerModal");
            const modalInstance = bootstrap.Modal.getInstance(modalElement);
            modalInstance.hide();

            // Initial load
            loadServer();
          })
          .catch((error) => {
            console.error("Error adding new server:", error);
            alert("Error adding new server");
          });
      });

      function checkPassword() {
        const passwordInput = document.getElementById("password");
        const warningMessage = document.getElementById("password-warning");

        if (passwordInput.value.length < 8) {
          warningMessage.style.display = "block";
        } else {
          warningMessage.style.display = "none";
        }
      }
    </script>
  </body>
</html>
